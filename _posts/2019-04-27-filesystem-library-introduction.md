---
layout: post
title:  "C++17 Filesystem Library Introduction"
date:   2019-04-27 09:00:00
categories: C/C++
---

# C++17 Filesystem Library(작성중) Introduction


> 이 포스트는 공군 작전정보통신단 체계개발실에서 복무('17~'19)하면서 **프로그래밍 동아리(LINK)** 에서 활동하면서 작성한 내용입니다.


작년 중반 즈음, 아주 재미난 이야기를 듣습니다. 어느 개발 팀장 중 하나가 코드 평가 항목 중 하나는 ‘라인 수’라는 발언을 했다는 소식. 한마디로, 라인 수가 많으면 ‘좋은’ 또는 ‘잘 짜여진 코드’ 이므로 우수한 것 아니냐 라는 이야기죠. 예.

개발실 병사라고 다 개발하는 사람만 있는 것도 아니고, 그건 영외자도 마찬가지이지만, 어쨌든 여기 개발실에 있다보면 별 황당한 소리를 다 들을 수 있습니다. 코드 라인 수가 많으면 좋은 코드라니. 그렇다면 긴 문장은 좋은 글인가라는 의문을 품게 합니다. 
 
<pre><code>
더군다나 
이렇게
글을 써도 
라인 수는
늘어나기 
마련인데
</code></pre>

뭐, 좋습니다. 마침 잠깐 짬이 난 김에 라인 수를 카운트하는 간단한 프로그램을 만들게 됩니다. 당시 맡고 있던 체계가 있었는데 내가 얼마나 작성했는지 그거라도 어디 한번 세어 보자라는 생각이었죠. 제로-베이스부터 시작한 프로젝트 였거든요.

자바를 주로 쓰는 사람은 알겠지만, 규모가 조금씩 불어나면 불어날수록, 기능을 분리하면 분리할수록 패키지 수는 늘어나고 그에 따른 클래스도 늘어납니다. 게다가 자바는 C++과 다르게 한 파일에 클래스 하나만 정의됩니다. 또 고맙게도 웹 프로젝트라 CSS, JSP, 자바스크립트 파일 등 클라이언트에 보여질 소스들은 각기 다른 폴더에 나뉘어져 들어가 있겠죠.

당시는 급하게 만든 나머지 파일 하나하나를 읽어 들여 라인을 세는 방식이었습니다. 예를 들면, 

(이미지)

path.txt라는 파일에 경로를 모두 적어두고, 그 경로를 읽고, 파일을 열고, 변수 하나를 선언하여 카운팅합니다.

```
(이미지)
```
뭐, 대략적인 소스는 아래와 같습니다.

```
(코드/이미지)
```

오래 전에 작성한 코드라 기억이 가물가물 하군요. 일단 path.txt를 열어둡니다. 그리고 라인을 하나씩 읽어서 [주소][파일명]을 문자열 형식으로 std::vector<string> 형 변수 pathList_에 추가하고 있네요.

```
(코드/이미지)
```

라인 하나씩 카운트하고 그냥 출력해줍니다. csv 형식으로 저장도 하네요. 저걸 돌려보면 

```
(이미지)
```

뭐, 이런식으로 저장은 될 겁니다. 

그런데, 파일 개수가 딱 봐도 너무 많습니다. 그리고 진행 중인 프로젝트인데 수시로 파일 명이 바뀌고, 추가되고, 삭제되고 하지요. 이건 딱 이정도로만 사용하는 게 적당한 것 같습니다. 지금 보니 너무 급히 짜서 어디 재사용할 수도 없는 코드네요.

반 년정도가 지난 지금, 다른 이유로 갑자기 라인 카운터가 필요해졌는데, 그 사이 프로젝트 버전(폴더)라던지 파일 개수라던지, 이름이라던지 너무 많이 바뀌었습니다. path.txt에 작성할 수도 있겠지만 그건 너무 노가다 작업이지요. 게다가 그러기 위해서는 모든 폴더, 모든 파일의 경로와 이름을 작성해야 합니다. 경로나 이름의 철자가 하나라도 틀리면 파일은 읽을 수 없으니 체크도 해 줘야 겠지요. 

아무리 생각해도 이건 아닌 것 같습니다. 때 마침 새로운 컴파일러를 얻었으니 이걸 한번 사용해보도록 하지요. 프로그램 목적은 아래와 같이 짜 보고 싶습니다.

1. **폴더 명을 지정했을 때, 하위 폴더에 있는 모든 파일을 보고 싶다. **
2. **모든 파일을 읽을 필요는 없다. 라이브러리 파일 등은 제외해야 하니까. 내가 작성한 소스만 골라 라인 개수를 세고 싶다.**

작년의 조잡한 라인 카운터를 제작할 당시는 1번 이유 때문에 포기했습니다. 일단 컴파일러 버전이 낮아 C++11도 제대로 지원하지 않았기 때문입니다. 첨부한 이미지는 Visual Studio(이하 VS) 2013 버전이지만 일부 라이브러리 문제 때문에 VS Platform Tool은 2010 버전을 사용했었습니다. 즉, 그나마 있던 2013도 에디터로만 이용될 뿐이었습니다. 

기존에 가지고 있던 컴파일러로 1번 관련 작업을 하기 위해서는 WinAPI를 알아야 했습니다. 그 외에 딱히 떠오르는 방법이 없더군요. WinAPI를 공부하면 되지 않느냐? 작은 집을 짓는데 콘크리트 기둥부터 세우는 격이죠. 시간 대비 결과가 뻔했습니다. 필요한 것만 뽑아 쓰면 되지 않느냐? 당시 맡고 있던 프로젝트를 빨리 진행해야 했기에 잠시 짬 날때 할 수 있는 일이 아니죠.

C++17에는 공식적으로 <filesystem> 라이브러리가 추가되었습니다. 이 라이브러리는 boost 라이브러리에 있던 것인데, C++17에 와서야 공식적으로 포함되었습니다. 그때 가지고 있던 컴파일러는 C++11 일부까지만 지원했기 때문에 음, 불가능. 

(이미지)

음, 새로운 컴파일러군요. VS2017 Professional입니다. 얼마 전 우연히 얻게 되었습니다. 그러면 <filesystem> 라이브러리가 있고, 맡고 있는 프로젝트도 얼추 마무리 단계에 들어갔으니 여유 있을 때 조잡한 라인 카운터를 한번 개선해보도록 하지요.

일단 <filesystem> 라이브러리를 봅시다. 